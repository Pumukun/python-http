{% extends "base.html" %}
{% block content %}

{% if files|length > 0 %}
<select size="{{ files|length }}" name="select-menu" id="select-menu" multiple="multiple">
	{% for file in files %}
	<option value="{{ loop.index }}">{{ file }}</option>
	{% endfor %}
</select>
<br>
{% endif %}

<button type="button" id="reload_btn">Reload</button>
</form>

<div class="input-table" style="display: inline">
	<label>filter</label><br>
	<input type="field"></input>
</div>
<div></div>

<div class="table" style="display: inline">
{{ csv_html_table|safe }}
</div>

<a href="{{ url_for('.download_file', name="test.csv") }}">Download</a>

<form id="download_form" method="POST" action="{{ url_for('download_file', name="") }}"
      enctype="multipart/form-data">
    <button type="submit" class="btn btn-primary">Скачать файл</button>
</form>

<script>
	const select = document.getElementById("select-menu");
	const form = document.getElementById("download_form");

	if (select.options.length === 1) {
		const url = "{{ url_for('download_file', name="") }}";
		form.action = url + select.options[0].text;
	}

	select.addEventListener("change", (event) => {
		const url = "{{ url_for('download_file', name="") }}";
		form.action = url + select.options[select.selectedIndex].text;
	});
</script>

<pre id="preview-text"></pre>
<div class="preview"></div>
{% endblock %}

